<?php
    session_start();
?>
<!doctype html>
<html lang="en">

<head>
    <link rel="shortcut icon" href="//theme.hstatic.net/1000271846/1001087843/14/favicon.png?v=86" type="image/png">

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Trang Chủ Chính Thức</title>
    <meta name="description" content="">
    <meta name="author" content="">
    <meta name="description"
        content="Website chính thức của Chú Bé Rồng Online – Game Bay Vien Ngoc Rong Mobile nhập vai trực tuyến trên máy tính và điện thoại về Game 7 Viên Ngọc Rồng hấp dẫn nhất hiện nay!" />
    <meta name="keywords"
        content="Chú Bé Rồng Online,ngoc rong mobile, game ngoc rong, game 7 vien ngoc rong, game bay vien ngoc rong" />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title"
        content="Website chính thức của Chú Bé Rồng Online – Game Bay Vien Ngoc Rong Mobile nhập vai trực tuyến trên máy tính và điện thoại về Game 7 Viên Ngọc Rồng hấp dẫn nhất hiện nay!" />
    <meta name="twitter:description"
        content="Website chính thức của Chú Bé Rồng Online – Game Bay Vien Ngoc Rong Mobile nhập vai trực tuyến trên máy tính và điện thoại về Game 7 Viên Ngọc Rồng hấp dẫn nhất hiện nay!"
        content="assets/images/nrogreen.png" content="200" content="200" />
    <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="assets/vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
    <script src="assets/vendor/jquery/jquery.min.js"></script>
    <script src="assets/vendor/notify/notify.js"></script>
    <link rel="icon" href="assets/images/icon.png?v=99">
    <link href="assets/css/main.css" rel="stylesheet" type="text/css">
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 0;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #fff;
            
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        h4 {
            color: #333;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            border: 1px solid #ddd;
        }

        th, td {
            padding: 15px;
            text-align: center;
            border-bottom: 1px solid #ddd;
        }

        th {
            background-color: #f2f2f2;
            font-weight: bold;
            text-transform: uppercase;
        }

        td {
            font-size: 14px;
        }

        a {
            color: #007bff;
            text-decoration: none;
        }

        a:hover {
            text-decoration: underline;
        }
        
        #snow {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            z-index: -100;
        }
    </style>
    <style>
    

    .game-icon {
        display: flex;
        justify-content: center;
        align-items: center;
        width: 25px;
        height: 25px;
        background-color: #007bff;
        /* Màu xanh */
        border-radius: 50%;
        /* Bo tròn hình ảnh */
        color: white;
        text-decoration: none;
        font-size: 13px;
    }

    .color-changing-text {
        display: flex;
        justify-content: center;
        align-items: center;
    }
    </style>
    
    
</head>

<body style="    background: linear-gradient(to right, rgb(199 95 95), rgb(124 183 124), rgb(62 62 189));">
<div id="snow"></div>
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        var script = document.createElement('script');
        script.src = 'https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js';
        script.onload = function() {
            particlesJS("snow", {
                "particles": {
                    "number": {
                        "value": 75,
                        "density": {
                            "enable": true,
                            "value_area": 400
                        }
                    },
                    "color": {
                        "value": "#63B8FF"
                    },
                    "opacity": {
                        "value": 1,
                        "random": true,
                        "anim": {
                            "enable": false
                        }
                    },
                    "size": {
                        "value": 3,
                        "random": true,
                        "anim": {
                            "enable": true
                        }
                    },
                    "line_linked": {
                        "enable": true
                    },
                    "move": {
                        "enable": true,
                        "speed": 1,
                        "direction": "top",
                        "random": true,
                        "straight": false,
                        "out_mode": "out",
                        "bounce": false,
                        "attract": {
                            "enable": true,
                            "rotateX": 300,
                            "rotateY": 1200
                        }
                    }
                },
                "interactivity": {
                    "events": {
                        "onhover": {
                            "enable": false
                        },
                        "onclick": {
                            "enable": false
                        },
                        "resize": false
                    }
                },
                "retina_detect": true
            });
        }
        document.head.append(script);
    });
    </script>

    <div class="container" style="border-radius: 15px; background: #BFEFFF; padding: 0px">
    
        <div class="container" style="background-color: #BFEFFF">
            <div class="row bg pb-3 pt-2">
                <div class="col">
                    </br>
                    <div class="color-changing-text">
                        <h4 class="shop text-center">
                            <script type="text/javascript" data-cfasync="false">
                            farbbibliothek = new Array();

                            farbbibliothek[2] = new Array("#824800", "#824800", "#824800", "#824800", "#824800",
                                "#925100",
                                "#a05900", "#b56500", "#c36d00", "#d27703", "#e48000", "#ff8f00", "#ff9209",
                                "#ffb900",
                                "#ffdc00", "#ffb900", "#ff9209", "#e48000", "#d27703", "#c36d00", "#b56500",
                                "#a05900",
                                "#925100", "#824800", "#824800", "#824800", "#824800", "#824800");
                            farben2 = farbbibliothek[2];

                            function farbschrift2() {
                                for (var i = 0; i < Buchstabe2.length; i++) {
                                    document.all["b" + i].style.color = farben2[i];
                                    document.all["b" + i].style.fontSize = "54px"; // Đặt kích thước chữ to hơn
                                }
                                farbverlauf2();
                            }

                            function string2array2(text) {
                                Buchstabe2 = new Array();
                                while (farben2.length < text.length) {
                                    farben2 = farben2.concat(farben2);
                                }
                                k = 0;
                                while (k <= text.length) {
                                    Buchstabe2[k] = text.charAt(k);
                                    k++;
                                }
                            }

                            function divserzeugen2() {
                                for (var i = 0; i < Buchstabe2.length; i++) {
                                    document.write("<span id='b" + i + "' class='b" + i + "'>" + Buchstabe2[i] +
                                        "<\/span>");
                                }
                                farbschrift2();
                            }

                            function farbverlauf2() {
                                for (var i = 0; i < farben2.length; i++) {
                                    farben2[i - 1] = farben2[i];
                                }
                                farben2[farben2.length - 1] = farben2[-1];

                                setTimeout("farbschrift2()", 70); // Đặt khoảng thời gian đổi màu chậm hơn
                            }

                            text2 = "THANRONG2017";
                            string2array2(text2);
                            divserzeugen2();
                            </script>
                        </h4>&nbsp;&nbsp;<a class="game-icon"><i class="fas fa-check"></i></a>
                    </div></br>
                    <div class="text-center pt-2">
                        <div style="display: inline-block;">
                            <a href="tai-ve/Android">
                                <img class="icon-download" src="assets/images/android.png"></a> </br>
                            <small class="text-dark">0.0.1</small>
                        </div>
                        <div style="display: inline-block;">
                            <a href="tai-ve/Pc"><img class="icon-download" src="assets/images/pc.png"></a> </br>
                            <small class="text-dark">0.0.1</small>
                        </div>
                        <div style="display: inline-block;">
                            <a href="tai-ve/Ios"><img class="icon-download" src="assets/images/ip.png"></a> </br>
                            <small class="text-dark">0.0.1</small>
                        </div>
                        <div style="display: inline-block;">
                            <a href="dangnhap"><img class="icon-download" src="assets/images/napngoc.png"></a> </br>
                            <small class="text-dark">0.0.1</small>
                        </div>
                        <div>
                            <img height="12" src="assets/images/12.png" style="vertical-align: middle;">
                            <small style="font-size: 10px" id="hour3">Dành cho người chơi trên 12 tuổi. Chơi quá 180
                                phút mỗi ngày sẽ hại sức khỏe.</small>
                        </div>
                        <video autoplay muted loop style="object-fit: cover; /* Cover the entire viewport */
            width: 100vw; /* Make the video take the full width of the viewport */
            height: 100vh; /* Make the video take the full height of the viewport */
            position: fixed;
            top: 0;
            left: 0;
            z-index: -1; /* Place the video behind other content */">
        <source src="assets/images/logo.mp4" type="video/mp4">
    </video>
                    </div>
                </div>
            </div>
        </div>
        <div class="container color-main2 pb-2" style="background-color: #BFEFFF">
            <div class="text-center">
                <div class="row">
                    <div class="col pr-0">
                        <a href="index" class="btn p-1 btn-header-active">Trang chủ</a>
                    </div>
                    <div class="col">
                        <a href="diendan" class="btn p-1 btn-header">Diễn Đàn</a>
                    </div>
                    <?php
                    if (!isset($_SESSION['id']) || !isset($_SESSION['username'])) {
                        echo '
                        <div class="col">
                            <a href="dangky" class="btn p-1 btn-header">Đăng Ký</a>
                        </div>
                        <div class="col">
                            <a href="dangnhap" class="btn p-1 btn-header">Đăng Nhập</a>
                        </div>
                        ';
                    }
                    ?>
                    <?php
                    if (isset($_SESSION['id']) || isset($_SESSION['username'])) {
                        echo '
                        <div class="col">
                            <a href="home" class="btn p-1 btn-header">Người Dùng</a>
                        </div>
                        <div class="col">
                            <a href="logout" class="btn p-1 btn-header">Đăng Xuất</a>
                        </div>
                        ';
                    }
                    ?>
                </div>
            </div>
        </div>
        <?php
            //Tính thời gian
            function formatTimeAgo($timestamp) {
                date_default_timezone_set('Asia/Ho_Chi_Minh'); // Đặt múi giờ cho múi giờ Đông Dương
                $now = time();
                $timeDiff = $now - strtotime($timestamp);

                $seconds = floor($timeDiff);
                if ($seconds < 60) {
                    return $seconds . " giây trước";
                }

                $minutes = floor($seconds / 60);
                if ($minutes < 60) {
                    return $minutes . " phút trước";
                }

                $hours = floor($minutes / 60);
                if ($hours < 24) {
                    return $hours . " giờ trước";
                }

                $days = floor($hours / 24);
                return $days . " ngày trước";
            }

            include "db_conn.php";

            // Truy vấn dữ liệu từ bảng diendan và sắp xếp theo created_at giảm dần
            $diendan_admin_query = "SELECT d.id, d.tieude, d.noidung, d.userid, u.username, d.created_at, d.diendancha, d.avatar
                                    FROM diendan d 
                                    INNER JOIN user u ON u.id = d.userid 
                                    WHERE d.diendancha = 0 and d.admin = 1
                                    ORDER BY d.created_at DESC";

            $diendan_admin_result = $conn->query($diendan_admin_query);

            $content = ""; // Khởi tạo biến để chứa nội dung HTML

            if (mysqli_num_rows($diendan_admin_result) > 0) {
                while ($row = mysqli_fetch_assoc($diendan_admin_result)) {
                    $content .= '<div class="box-stt">';
                    $content .= '<div style="width: 40px; float:left; margin-right: 25px;">';
                    $content .= '<a href="chitietdiendan?id='. $row["id"] .'"><img src="assets/images/avatar/' . $row["avatar"] . '" style="width: 50px ; height:50px"></a>';
                    $content .= '</div>';
                    $content .= '<div class="box-right">';
                    $content .= '<b><a href="chitietdiendan?id='. $row["id"] .'">' . $row["tieude"] . ' <img src="assets/images/hot.gif"></a></b>';
                    $content .= '<div class="box-name" style="font-size: 14px;">';
                    $content .= 'bởi ' . $row["username"] . ' <a style="float: right"><i>' . formatTimeAgo($row["created_at"]) . '</i></a></div>';
                    $content .= '</div>';
                    $content .= '</div>';
                }
            } else {
                $content .= "<div class='box-stt'><div class='box-right'><a href='#'>Không có bài viết nào.</a></div></div>";
            }
            mysqli_close($conn);
        ?>
        <div class="container color-forum pt-2" s style="background-color: #87CEFA">
            <div class="row">
                <div class="col">
                    <?php echo $content; ?>                  
                </div>
            </div>
        </div>
        <?php if (isset($_GET['error'])) { ?>
        <div style="display: block; padding-left: 50px; height: 30px; padding-top: 10px;">
            <p style="color: red; font-weight: bold;" class="error">
                <?php echo $_GET['error']; ?>
            </p>
        </div>
        <?php } ?>

        <?php if (isset($_GET['success'])) { ?>
        <div style="display: block; padding-left: 50px; height: 30px; padding-top: 10px;">
            <p style="color: blue; font-weight: bold;" class="success">
                <?php echo $_GET['success']; ?>
            </p>
        </div>
        <?php } ?>

        <?php
            include "db_conn.php";

            // Truy vấn dữ liệu từ bảng diendan và sắp xếp theo created_at giảm dần
            $query = "SELECT d.id, d.tieude, d.noidung, d.userid, u.username, d.created_at, d.diendancha, d.avatar
                    FROM diendan d 
                    INNER JOIN user u ON u.id = d.userid 
                    WHERE d.diendancha = 0 and d.admin = 0
                    ORDER BY d.created_at DESC";

            $postsPerPage = 10; // Số bài viết trên mỗi trang
            $totalPosts = mysqli_num_rows(mysqli_query($conn, $query));
            $totalPages = ceil($totalPosts / $postsPerPage);

            $currentUrl = $_SERVER['PHP_SELF']; // URL của trang hiện tại

            $page = isset($_GET['page']) ? intval($_GET['page']) : 1;
            $start = ($page - 1) * $postsPerPage;
            $queryWithLimit = $query . " LIMIT $start, $postsPerPage";
            $resultWithLimit = mysqli_query($conn, $queryWithLimit);

            $content = ""; // Khởi tạo biến để chứa nội dung HTML

            if (mysqli_num_rows($resultWithLimit) > 0) {
                while ($row = mysqli_fetch_assoc($resultWithLimit)) {
                    $content .= '<div class="box-stt" style="border-bottom: 1px solid #CFCFCF; height:60px ">';
                    $content .= '<div style="width: 30px; float:left; margin-right: 25px;">';
                    $content .= '<a href="chitietdiendan?id='. $row["id"] .'"><img src="assets/images/avatar/' . $row["avatar"] . '" style="width: 50px ; height:50px"></a>';
                    $content .= '</div>';
                    $content .= '<div class="box-right">';
                    $content .= '<a href="chitietdiendan?id='. $row["id"] .'">' . $row["tieude"] . '</a>';
                    $content .= '<div class="box-name" style="font-size: 14px;">';
                    $content .= 'bởi ' . $row["username"] . ' <a style="float: right"><i>' . formatTimeAgo($row["created_at"]) . '</i></a></div>';
                    $content .= '</div>';
                    $content .= '</div>';
                }
            } else {
                $content .= "<div class='box-stt'><div class='box-right'><a href='#'>Không có bài viết nào.</a></div></div>";
            }
            mysqli_close($conn);
        ?>


        <div class="container color-forum2 pt-2" style="background-color: #BFEFFF">
            <div class="row">
                <div class="col">
                    <?php echo $content; ?>
                </div>
            </div>
        </div>

        <div class="container pb-2" style="background-color: #BFEFFF">
            <div class="row mt-3">
                <div class="col-3">
                    <a class="btn btn-main btn-sm" href="nhapdiendan">Đăng bài</a>
                </div>
                <div class="col-9 text-right">
                    <?php if ($totalPages > 1) : ?>
                    <?php if ($page > 1) : ?>
                    <a href="<?php echo $currentUrl . '?page=1'; ?>" class="btn btn-sm btn-light">
                    <<</a>
                        <?php endif; ?>

                            <?php for ($i = 1; $i <= $totalPages; $i++) : ?>
                            <?php if ($i === 1 || $i === $totalPages || ($i === $page - 1) || ($i === $page) || ($i === $page + 1)) : ?>
                            <a href="<?php echo $currentUrl . '?page=' . $i; ?>"
                                class="btn btn-sm <?php echo $page === $i ? 'page-active' : 'btn-light'; ?>"><?php echo $i; ?></a>
                            <?php elseif (($i === $page - 2) || ($i === $page + 2)) : ?>
                            <span class="btn btn-sm btn-light">...</span>
                            <?php endif; ?>
                            <?php endfor; ?>

                            <?php if ($page < $totalPages) : ?>
                            <a href="<?php echo $currentUrl . '?page=' . $totalPages; ?>"
                                class="btn btn-sm btn-light">>></a>
                            <?php endif; ?>
                        <?php endif; ?>
                </div>
            </div>
        </div>



        <div class="border-secondary border-top"></div>
        <div class="container pt-4 pb-4 text-white" style="background-color: #63B8FF">
            <div class="row">
                <div class="col">
                    <div class="text-center">
                        <div style="font-size: 13px" class="text-dark">
                            <small>2023©THANRONG2017</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</body>